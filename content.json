[{"title":"cookie 欺骗进后台","date":"2017-04-21T10:47:59.249Z","path":"2017/04/21/Cookie欺骗进后台/","text":"听说没有“实战”的博客不是好博客。就下载了个CMS来测试下性能–&gt;phpecms1.3 登陆页面： phpecms1.3/admin/cms_check.php文件有一段代码 &lt;?php if(!isset($_COOKIE['admin_name'])){ alert_href('非法登录','cms_login.php'); }; ?&gt; 这代码意思是如果cookie是admin_name 则跳转成功，如果是其它则非法登陆。 /phpecms1.3/admin/cms_welcome.php文件： &lt;?php include('../system/inc.php'); include('cms_check.php'); ?&gt; &lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"&gt; &lt;html xmlns=\"http://www.w3.org/1999/xhtml\"&gt; &lt;head&gt; &lt;?php include('inc_head.php') ?&gt; &lt;/head&gt; &lt;body&gt; &lt;?php include('inc_header.php') ?&gt; &lt;div id=\"content\"&gt; &lt;div class=\"container\"&gt; &lt;div class=\"line-big\"&gt; &lt;?php include('inc_left.php') ?&gt; &lt;div class=\"xx105\"&gt; &lt;div class=\"hd-1\"&gt;使用声明&lt;/div&gt; &lt;div class=\"bd-1\"&gt; &lt;p&gt;一、遵守中中华人民共和国相关法律，合法使用。&lt;/p&gt; &lt;p&gt;二、此程序为免费版，无使用时间限制。&lt;/p&gt; &lt;p&gt;三、商业使用建议使用收费版，获取更多功能和技术服务。&lt;/p&gt; &lt;p class=\"fb color-red\"&gt;免费版和收费版的主要差异&lt;/p&gt; &lt;p&gt;一、支持手机版&lt;/p&gt; &lt;p&gt;二、多套模板后后台切换&lt;/p&gt; &lt;p&gt;三、更多的频道类型和详情类型选择&lt;/p&gt; &lt;p&gt;四、支持伪静态&lt;/p&gt; &lt;p&gt;四、咨询QQ：&lt;a href=\"http://wpa.qq.com/msgrd?v=3&amp;uin=5474131&amp;site=qq&amp;menu=yes\"&gt;5474131&lt;/a&gt; 电话：13400472755 网址：&lt;a href=\"http://www.pcfinal.cn\" target=\"_blank\"&gt;[url=http://www.pcfinal.cn]www.pcfinal.cn[/url]&lt;/a&gt;&lt;/p&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;?php include('inc_footer.php') ?&gt; &lt;/body&gt; &lt;/html&gt; 后台文件没有任何判断，直接包含进去 如图增加新cookie及修改： 刷新修改过的URL，成功进入后台","tags":[]},{"title":"解析漏洞总结","date":"2017-04-21T00:53:30.382Z","path":"2017/04/21/解析漏洞/","text":"解析漏洞:解析就是把代码用指定语言运行出来,解析漏洞就是在运行的过程中没按照原先设定的计划去把语言运行出来,而是运行了另一种过程。 IIS文件解析漏洞： ①：当建立.asa 、.asp 的格式文件夹时，其目录下的任意文件都以asp的文件来解析。 例子：在asp文件夹下新建一个txt文件，但是访问该TXT文件时，如果有代码为函数，将以asp的方式去解析，去利用该文件 ②：当文件为*.asp;1.jpg时，IIS同时会以asp脚本来执行（分号后面内容不被解析。貌似该漏洞只存在于6.0版本） ③：WebDav扩展漏洞： 此扩展支持：PUT/Move/Copy/Delete等方法 其中PUT方法可用于服务器上传脚本文件（工具有桂林老兵PUT） Move：移动文件 Copy:改动文件，例如改动后缀名使文件变为shell。 Apacher解析漏洞（与IIS有所不同）：① ：假如有个1.php.rar文件内容为&lt;?php phpinfo(); ?&gt;那么打开1.php.rar文件时并不是下载，而是现在phpinfo文件。② ：Apache解析扩展名时从后面解析，直至遇到认识的扩展名为止。 PHP CGI解析漏洞（Nginx服务器漏洞）： 例如：当访问URL=www.baidu.com/1.jpg时显示的是一张图片，但是当加上/.php时就以Php形式去解析这张图片了。 IIS 7.0/IIS 7.5/ Nginx 的文件，然后访问mst.jpg/.php,在这个目录下就会生成一句话木马 shell.php。 在windows环境下：xx.jpg[空格] 或xx.jpg. 这两类文件都是不允许存在的，若这样命名，windows会默认除去空格或点,黑客可以通过抓包，在文件名后加一个空格或者点绕过黑名单.若上传成功，空格和点都会被windows自动消除,这样也可以getshell。","tags":[{"name":"Web安全","slug":"Web安全","permalink":"http://yoursite.com/tags/Web安全/"},{"name":"文件解析","slug":"文件解析","permalink":"http://yoursite.com/tags/文件解析/"}]},{"title":"HTTP参数污染","date":"2017-04-18T02:06:23.435Z","path":"2017/04/18/Http参数污染/","text":"HTTP参数污染：我也不知道怎么解释。。语言水平不好。这种方法通常用来绕过WAF应用防火墙的检测。 PHP类型：http://127.0.0.1/test.php?id=7 or 1=1 in (SQLi)如果会出现“请停止攻击该网站”等提示。 这时我们可以尝试参数污染来绕过该WAF。当我们输入：?id=7&amp;id=（sqli)时 waf网络层会解析id=7， –&gt; 显示合法PHP应用层会解析 id=(sqli) –&gt; 注入成功 利用：把参数利用拼接符写在后面来绕过。 asp类型: ?id=1&amp;id=s&amp;id=e&amp;id=l&amp;id=e&amp;id=c&amp;id=t 如果它接受到两个参数值，它会拼接两个相同参数的值，因此你可以将被过滤的关键词拆分到两个参数中进行攻击从而绕过WAF。 如上面我写参数拼接在一起的就带有selec效果了。","tags":[]},{"title":"旁注攻击","date":"2017-04-15T09:42:25.351Z","path":"2017/04/15/旁注攻击/","text":"旁注攻击：同一台服务器上有多个网站。当A网站攻不下时，发现还有B网站也是同一个服务器时就尝试去攻占B网站。如果得到B网站的服务器权限也就相当于得到A网站的服务器权限。 过程： IP逆向查询：查询A域名的真实IP，然后反查IP得出IP（服务器）拥有的其它网站。（但这并不代表这是服务器所有的网站，因为这些都是通过收录得到的）注：注意查看是否使用了CDN 得到其它网站后，就渗透其它的网站，直至得到此网站的权限，后提权XXOO。。。 SQL跨库查询：垮库查询攻击假设A,B网站的同为一个服务器，且皆使用同一种数据库，A数据库为ADB，B数据库为BDB。如果B数据库在操作时可以对A数据库动刀，那么就称为跨库攻击。 其实和SQL注入差不多，例如，B网站注入成功并爆出数据库，那应该也爆出A网站的数据库（因为同为一个数据库软件），如果B网站的权限可以下载A或者查看A数据库的信息，那么久垮库攻击成功 目录越权：假如B网站上传了一个Webshell，在读取B网站的同时，发现可以去A网站的目录读取A网站的信息，则称为目录越权。假设还有写入权限，即可往A网站写入Shell。注：尽管只有读取权限，也可读取数据库信息，或者后台位置，或者利用代码审计进行攻击。 C段查询：https://www.phpinfo.me/bing.php子域名爆破：https://www.phpinfo.me/domain","tags":[{"name":"Web安全","slug":"Web安全","permalink":"http://yoursite.com/tags/Web安全/"}]},{"title":"文件包含漏洞","date":"2017-04-15T03:51:16.310Z","path":"2017/04/15/文件包含漏洞/","text":"文件包含漏洞：服务器通过php的特性（函数）去包含任意文件时，由于要包含的这个文件来源过滤不严，从而可以去包含一个恶意文件，而我们可以构造这个恶意文件来达到邪恶的目的。（其实不止PHP，ASP、JSP,、ASP.Net都存在文件包含漏洞）因为程序人员通常把重复使用的函数写到单个文件，在使用时就直接调用此文件，调用文件的过程就是文件包含。也因为PHP语言提供的文件包含太灵活和强大，所以漏洞或许多些。 PHP中有四个包含函数：incluede（）、include_once（）、require（）、require_once（）。 Include（）：函数包含文件时，只有代码执行到include()函数时将文件包含进来。发生错误时系统只给出一个警告，继续向下执行。 include_once（）：函数基本和include()相同，不过差别是：重复调用同一文件时，程序只调用一次。建议尽量使用include_once()函数不会因为重复包含文件而发生错误。 Require（）函数与include（）的差别是：1， 如果发生错误，函数会输出错误信息，并立即终止脚本的处理。2， 函数调用文件时，只要程序一执行，立即调用文件，而include()只有程序执行到该函数时，才调用。 require_once（）：此行语句和require（）语句类似，唯一区别就是如果该文件中的代码已经被包含，则不会再次包含。 文件包含分类：远程包含（LFI）、本地包含（RFI）。 区别：被包含的文件在服务器本地时，就形成的本地文件包含漏洞，被包涵的文件在第三方服务是，就形成了远程文件包含漏洞。 漏洞成因：在通过引入文件时，引用的文件名，用户可控，由于传入的文件名没有经过合理的校验，或者校验被绕过，从而操作了预想之外的文件，就 可能导致意外的文件泄露甚至恶意的代码注入。 用法：正常URL：www.xxoo.com/action/n=file.php 假如根目录存在文件包含漏洞：www.xxoo.com/action/n=../../../../robots.txt（多../几个可以确保回到根目录）则把robots.txt文件读取出来，假如robots.txt符合PHP代码类型，则按照php代码类型去执行robots文件（其实无论哪个文件后缀，只要符合PHP类型，则按PHP解析文件。不然则以文本格式显示文件内容） 远程包含：www.xxoo.com/action/n=http://www.bbb.com/2/n=robots.txt 则输入 http://www.bbb.com网站的robots.txt文件 前提：都有包含漏洞。都开启了allow_url_include=on 注：1.其实有些版本还支持%00截断，例如www.xxoo.com/action/n=file.php%00.jpg。但是解析是以php解析（绕过后缀必须为指定后缀）。2.str_replace（）：将”http:// ”、”https://”、 ” ../”、”..\\”替换为空字符 绕过：双写绕过替换规则如page=hthttp://tp://192.168.1.1/robots.txt (应用于远程包含)3.当运用个别包含函数时，输入错误文件可爆出绝对路径","tags":[{"name":"Web安全","slug":"Web安全","permalink":"http://yoursite.com/tags/Web安全/"}]},{"title":"社会工程学","date":"2017-04-15T03:51:14.416Z","path":"2017/04/15/社会工程学/","text":"社会工程学：俗称的社工。通过对人的本性，弱点，好奇心、信任、贪婪等心里陷阱进行欺骗的一种危害手段。俗话说的“攻城为下，攻心为上”这句话就是披露社会工程学的巨大力量。每一个强大的社工人员必然也是一个优良的“读心术”及沟通专家。 社工工作： 信息收集：比如说电话号码，名字，工作的ID号，什么手机号啊，出生日期，身份证号，邮箱，账号，常流浪的网页等等看似无关的信息。方法：Google Hack 、Whois、whois反查、网站的社工裤 沟通方法：“诚心以待”去获取员工的帮助。 伪造某人信息去代替他方法：在充分得到某领导信息后，向底层人员假装获取信息","tags":[{"name":"信息收集","slug":"信息收集","permalink":"http://yoursite.com/tags/信息收集/"}]},{"title":"暴力破解","date":"2017-04-15T03:51:14.415Z","path":"2017/04/15/暴力破解/","text":"暴力破解：也可称为弱口令猜解，通常和社工（社会工程学）挂钩，过程需要有强大的字典。特殊情况不用，例如admin、admin123、admin888、adminadmin等若口令可手工猜解。弱口令字典在线生成网站：http://pass.cnseay.com/ 利用Burpsuit破解： 抓包 发送包到Intruder 选择变量Sniper：对变量一次进行破解（依照变量数进行所有字典的组合）Battering ram：对变量同时进行破解（密码和账号是同一个，直至轮完字典）Pitchfork：每个变量对应一个字典（组合为最小字典的数量）Cluster bomb：每个变量对应一个字典，并交集破解（A字典*B字典） 选择Payload type（这个看字典类型来选） Payload options 选择字典并导入，或者自己添加 点击Start attack 开始破解。 在弹出的Intruder attack 查看Length 的返回值，不一样长度则表现出返回的内容不同，所以字段不同，所以有可能是破解成功的Payload 其它工具还有PKAV等。PKAV：适用于爆破带有图片验证码的。但是本身不抓包，需配合抓包工具导请求包。 遇到特殊情况：1.假如存在验证Token值时：https://my.oschina.net/oby/blog/8475222.存在验证码时： 验证码固定：输入正确验证码后抓包，爆破登录账号和密码 验证码不点击确定时不重新获取：输入正确验证码后抓包，爆破登录账号和密码 3.验证码：不为图片（为数据时） 抓取网页源代码读取验证码位置。4.带有登录时效：设置线程爆破5.带有IP登陆次数限制：6.登陆的密码和账号进行过加密：需要知道加密的JS文件http://www.myhack58.com/Article/60/61/2017/83932.htm","tags":[{"name":"Web安全","slug":"Web安全","permalink":"http://yoursite.com/tags/Web安全/"}]},{"title":"URL跳转与钓鱼","date":"2017-04-10T09:46:39.446Z","path":"2017/04/10/URL跳转与钓鱼/","text":"URL跳转：分为客户端跳转和服务端跳转。但是结果都是一样，跳到另外一个页面。 客户端跳转称为：URL重定向 服务端跳转称为：URL转发URL重定向例子： 当前URL为：www.xxoo.com/ppp.php 点击“登陆”按钮后 URL变为 ：www.xxoo.com/login.php 注：重定向状态码为：302 URL转发例子： 当前URL为：www.xxoo.com/ppp.php 点击“登陆”按钮后URL还是 ：www.xxoo.com/ppp.php （没变化） 不是所有的跳转都和上面有关，而是直接向服务器发送请求，例如： 例如：&lt;a href=”http://www.xxoo.com/new.jsp”&gt;新闻30分&lt;/a&gt;点击新闻30分按钮，跳到http://www.xxoo.com/new.jsp 页面。 和URL重定向区别：是直接向服务器发送请求，而不用间接的发送302状态码来跳转。（个人理解。。） 钓鱼：钓鱼网站：域名和某个页面做的非常相似，而且域名也相差无几。当受害者打开此网页，粗略的看了一下域名，发现页面也做的很像，然后输入账号密码，就被钓鱼了。 利用的相识字符：I(大写i)、l（小写L）和1D、O、0S、5M、N 绕过 恶意URL 策略：URL跳转：例如：http://www.baidu.com/test?=http://ta0bao.com（打开URL时中途会发送一个302重定向数据包） 注：URL转发不可作为URL跳转漏洞，因为URL转发无法进行域名的跳转，所以URL跳转漏洞也称为重定向漏洞。 php，ASP，ASP.Net 都有类似的重定向， 例如PHP的： &lt;?php $url=$_GET(‘url’) Header(“Location:$url”); ?&gt;","tags":[]},{"title":"上传篇","date":"2017-04-10T09:41:32.381Z","path":"2017/04/10/上传篇/","text":"上传：管理员用来管理网页，编辑网页的一个功能。也是攻击者用来上传Webshell的一个功能，没什么特殊情况一般存在于后台。当然也是有特殊的，例如注入上传，截包修改内容上传，修改个人头像时上传等。 其中上传漏洞一般为以下几种： 任意文件上传（无类型限制） IIS文件解析漏洞上传图片等文件（ma.asp;.jpg我也当是图片了。。） 利用文件编辑器的漏洞上传 抓包，构造文件上传漏洞。 如果是本地的JS验证，可关闭JS上传或者中间人攻击。 绕过上传漏洞： 客户端使用本地javascript对扩展名验证：1.本地构造上传HTML提交突破JS验证2.查看元素，删除onsubmit事件。3.先上传JPG后缀名，然后抓包再修改后缀名。如果本地检查的是MIME:则同理，抓包修改mime类型。注意修改类型的同时，修改Content-Length长度。4.利用空格（windows 会把空格给过滤。） 服务端扩展名检测：白盒：1.如果IIS可利用上述的IIS漏洞，2.cgi漏洞，3.%00截断上传，4.MIME验证：抓包修改 gif image/gif jpg image/jpeg php application/octet-stream asp application/x-asap png image/png 7z application/octet-stream txt text/plain rar application/octet-stream 5.运用::$DATA数据流上传，具体我也忘了，上次比赛GET到的。用法：如filename=1.php 修改为:filename=1.php::$DATA 黑盒：1.这类比较容易绕过，尝试一切后缀名，总有漏鱼之网。。例如cer，，asa2.尝试错误后缀名上传，例如“asp. （点）” “asp (空格)” 上传成功后windows系统自动剔除非法扩展名字符。然后剩下asp 目录验证：抓包时，如果看到路径，可尝试修改路径名，因为如果不存在路径文件名，系统一般会创建，然后利用IIS解析漏洞进行解析。 服务端使用重命名：1.抓包查看返回包2.查看源代码。 文本编辑器上传漏洞：FCKeditor（现更名为CKEditor）： 查看版本信息：/FCKediter/editor/dialog/fck_about.html 默认上传路径： FCKeditor/editor/filemanager/browser/default/browser.html FCKeditor/editor/filemanager/browser/default/connectors/test.html FCKeditor/editor/filemanager/browser/ upload/test.html FCKeditor/editor/filemanager/connectors/test.html FCKeditor/editor/filemanager/ uploadtest.html JSP 版：FCKeditor/editor/filemanager/browser/default/browser.html FCKeditor&lt;=2.4.3版本采用黑名单限制，但是忽略了以下后缀名：1.cer和asa等。2.而且存在任意文件上传漏洞(因为上传判断时，Media上传类型没定义，那上传时把URL改成————–/Upload.php?type=Media那上传时服务器就缺少文件后缀名验证机制。) 其它漏洞：asp.net二次传。建立畸形文件夹。 Fckeditor利用： 高版本过滤 “.“变”_“过滤Logo.asp;.jpg ==&gt; logo_asp;.jpg 其它编辑器漏洞:Ewebeditor/Ueditor/KindEditor/Xheditor Ewededitor:asp 默认密码：admin默认后台：ewebeditor/admin_login.asp默认数据库：ewebeditor/db/ewebeditor.mdb","tags":[{"name":"Web安全","slug":"Web安全","permalink":"http://yoursite.com/tags/Web安全/"},{"name":"上传文件","slug":"上传文件","permalink":"http://yoursite.com/tags/上传文件/"}]},{"title":"逻辑错误漏洞","date":"2017-04-10T08:57:07.994Z","path":"2017/04/10/逻辑错误漏洞/","text":"逻辑漏洞：由于程序逻辑不严或逻辑太复杂，导致一些逻辑分支不能够正常处理或处理错误.(程序不能处理一些逻辑上的漏洞，但并不代表程序会出错。)例如：这件在本地验证时值10元，传到服务端也是10元，那么问题来了，假如一件10元的物品被修改成1元传到服务器，服务端没有验证，是不是也是用1元来解析物品价格呢，逻辑漏洞就是这种。 出现地方：业务流程上。所以一般工具都无法识别。 例如：修改密码，找回密码，修改个人资料，物品购买时资金提交等。 绕过授权验证： 水平越权：相同级别用户之间的信息访问或修改 垂直越权：不同级别直接的用户的信息访问或修改（例如：用户和管理员） 例子：当访问我的个人信息时（假设我的账号为123456），URL为：www.qwerdf.com/user/Information?id=123456.php但当我把URL改为：www.qwerdf.com/user/Information?id=456.php也访问了账号456的人的信息，就称为水平越权。 当我把user改成admin,（假设某一位管理员ID=1）URL为：www.qwerdf.com/admin/Information?id=1.php时我也访问了管理员信息就称为垂直越权 当然，除了查看信息，删除，修改，增加等非正常操作都是越权。 密码找回逻辑漏洞：假设：www.xxoo.com/mima/back.asp 为一个密码找回页面当我填写找回密码的账号时，跳到身份验证这一步，获取验证码，填写正确后，就会跳到设置新密码那一步，然后完成。 但是如果身份验证那一步没设置好，就会出现密码找回的逻辑漏洞。 假设我在身份验证的时候抓包，发现包里有个验证手机号码为：186**。然后我把包里的号码修改为其它手机号，发现其它手机号接收到了验证码，我就可以凭借这验证码修改密码了。 这就是逻辑漏洞。 利用过程：1.输入其它账号，2.到身份验证时修改原本的验证号码的信息。3.得到返回的验证码后4.加以利用就可以做出修改了。 支付逻辑漏洞：原理同上。。都是在发送服务器端支付信息时修改里面的内容即可。 利用地方：1.商品数量2.商品价格3.商品折扣4.商品运费5.商品信息的中转、跳转、到支付接口时的参数。 （当类型判断不正确时，例如加入数量应该为整型，但是强行修改为字符型或其它不相关的类型时，有可能会导致系统崩毁或报错） 账户的恶意攻击： 假入A账户要冻结B账户的银行卡。操作如下： A账户输入B账户的银行卡信息，然后故意输错密码 当系统的安全机制（防爆破）提示还可输错4次时 A再进行输错的操作 B账户冻结 账户的恶意攻击成功实施。","tags":[]},{"title":"CSRF","date":"2017-04-10T08:52:49.589Z","path":"2017/04/10/CSRF/","text":"CSRF（跨站请求伪造）：也被称为XSRF，感觉和CSS被称为XSS差不多。CSRF与XSS区别：XSS利用站点内的信任用户，而CSRF则通过伪装来自受信任用户的请求来利用受信任的网站（个人理解：是否需要直接获取用户权限。） CSRF成功要领：1. CMS开源（因为要知道网站页面的一点信息才能构造CSRF代码。）2．无需验证码验证3．无referer和token （token其实可以获取，referer用来防外链）4．管理员正在后台或者网站储存着有效Cookie5．….. 1.查看该CMS源码，如我知道该源码为DWVA CMS，下载分析，发现修改管理员的地方没有Token验证，于是查看并构造代码： 2.表单写入文本 3.修改action的值（#提交数据到本页，但如果是网站，应修改为网站的路径） 添加value（要操作的数值）。最终修改如下：保存为html格式。4.打开并按按钮，成功发现成功修改，。然后我们可以把这玩意用邮件发送给目标站点的管理员并用社会工程学让他打开了。。顺便叫他按一下按钮。。 当然，还以当他打开时就自动提交，例如：添加JS机制。添加JS后修改的代码如下：其实这样是错误的。。因为没有执行”submit”按钮 想了好久想不通，找了个程序员大牛把代码修改了一下下，直接提交整个表单就得了，代码如下：注： js提交表单时不会带上 submit 按钮的值(因为没有被点击) 所有浏览器input 回车提交 w3c浏览器会带上submit按钮的值，ie6则不会带（所以把提交按钮的类型从submit换成了password.） 【只要点开这个文本就执行代码】 当然，，管理员对于未知文件怎么可能会轻易点开呢，所以我们还有个XSS+CSRF的利用方法（不知是不是这就是大佬们说的绝配。）前提：存在个XSS点。且熟悉ajax操作。因为不熟悉，所以。。","tags":[{"name":"Web安全","slug":"Web安全","permalink":"http://yoursite.com/tags/Web安全/"}]},{"title":"XSS","date":"2017-04-10T08:11:39.110Z","path":"2017/04/10/XSS/","text":"Xss（CSS）：跨站脚本漏洞。分为存储型、反射型、DOM型。一般使用javascript语言编写（还有ActionScript/VBScrip等客户端脚本语言）。反射型（非持久性）：不存储在服务器端，例如发送一个带有XSS的URL存储型（持久性）：储存在服务器端，当用户访问带有XSS页面时，解析XSS代码。例如留言板。DOM型：没怎么了解，后续了解了再补充。javascript可以用来获取用户的Cookie、改变页面内容\\URL跳转等。Xss测试语句：12345678&lt;script&gt;alert(document.domain)&lt;/script&gt;\"/&gt;&lt;script&gt;alert(document.domain)&lt;/script&gt;&lt;\"（闭合Input标签）‘”()%26%25&lt;acx&gt;&lt;ScRiPt &gt;alert(9528)&lt;/ScRiPt&gt;（大小写绕过）\" onmouseover=alert(document.domain) align=\"left（需移动鼠标） “onclick=”alert(‘1’) （需要点击框才弹） &lt;img src=x onerror=alert(‘1’)&gt; &lt;body onload=alert(‘XSS’)&gt;... XSS例子:ARRAY_KEY_EXISTS():判断函数，如果name变量有值&amp;&amp;（与）不为空，则输出 “ Hello+&amp;_GET[‘name’] “。思路：无过滤，直接XSS代码可执行。 Str_replace():判断是否存在&lt; script&gt;,存在则把&lt; script&gt;替换成空格，然后再把输入的东西传递给name变量。再输出。思路：运用不带有&lt; script&gt;的Javascript语言去运行XSS代码，或者把&lt; script&gt;大小写。 Prog_replace()：和楼上类似。不过是执行一个正则表达式的搜索和替换。比楼上的高级，它会对用户所有的有效输入字符进行匹配检查，并将无效字符替换为空。思路：还是和楼上一样，只不过是不能运用这&lt; script&gt;这些字符，大小也不可以。但是我们可以用其它标签，比如body标签、img标签等。 checkToken：用来检查session_token是否过期。Htmlspecialchars()：把预定义字符（&amp;、”、&lt;、&gt;）转为HTML实体化的的函数（只有设置了：quotestyle 选项为ENT_QUOTES才会过滤单引号）。 **思路：1.因为没有过滤单引号，所以可以用 ‘onmouseover=alert’(1)’语句来弹窗，但是然并卵，， 2.跳出Htmlspecialchars()函数重新赋值给$name，例POC：但还是不行，因为你在构造的时候就已经被实体化了，后面的语句根本无法有效运行。 思路暂时没有，，等有想法再补充。 XSS绕过：1.利用空格或者回车2.对标签属性进行编码1&lt;IMG SRC=javascrip&amp;#116&amp;#58alert('xss')&gt; 3.大小写4.用eval函数进行十六进制和十进制的编码1&lt;img src=\"javascript:eval(string.formCharCode(97,98,99.....))\"&gt; 注：1.输入的东西是否被转移，看源代码即可2.对website有http-only、crossdomian.xml没有用3.可以明面上输入&lt; “ &gt; ‘ 等字符测试，看源代码有哪些没被转义就用哪些。4.需要大量测试（测试闭合标签） 经典：http://www.freebuf.com/articles/web/40520.html","tags":[]},{"title":"代码注入之XPath篇","date":"2017-04-08T09:39:58.589Z","path":"2017/04/08/代码注入之XPath篇/","text":"XPath：XML的路径语言（选取XML节点的一门语言）（和XML注入类似） 例如 user.xml文件是这么写的： &lt;users&gt; &lt;user&gt; &lt;firstname&gt;Ben&lt;/firstname&gt; &lt;lastname&gt;Elmore&lt;/lastname&gt; &lt;loginID&gt;abc&lt;/loginID&gt; &lt;password&gt;test123&lt;/password&gt; &lt;/user&gt; &lt;user&gt; &lt;firstname&gt;Shlomy&lt;/firstname&gt; &lt;lastname&gt;Gantz&lt;/lastname&gt; &lt;loginID&gt;xyz&lt;/loginID&gt; &lt;password&gt;123test&lt;/password&gt; &lt;/user&gt; 那XPath的一般查询语句是这样写的： //users/user[loginID/text()=’xyz’and password/text()=’123test’] 但是，可以采用如下的方法实施注入攻击，绕过身份验证。如果用 户传入一个 login 和 password，例如 loginID = ‘xyz’ 和 password = ‘123test’，则该查询语句将返回 true。但如果用户传入类似 ‘ or 1=1 or ‘’=’ 的值，那么该查询语句也会得到 true 返回值，因为 XPath 查询语句最终会变成如下代码：//users/user[loginID/text()=’’or 1=1 or ‘’=’’ and password/text()=’’ or 1=1 or ‘’=’’] 这个字符串会在逻辑上使查询一直返回 true 并将一直允许攻击者访问系统。攻击者可以利用 XPath 在应用程序中动态地操作 XML 文档。攻击完成登录可以再通过XPath盲入技术获取最高权限帐号和其它重要文档信息。 利用手段：和SQL+XSS注入类似，闭合符合，然后构造POC利用位置：查询口","tags":[]},{"title":"代码注入之XML篇","date":"2017-04-08T09:38:42.897Z","path":"2017/04/08/代码注入之XML篇/","text":"XML：可扩展标识语言（和超文本标记语言有点类似，不过标签是带有自定义性质的，带有补充超文本语言的性质） （这个注入就是改写XML文件来利用。都需要闭合标签，然后插入数据，形式和SQL注入+XSS差不多） 报错语句: ‘ or (payload) or ‘‘ and (payload) and ‘‘ or (payload) and ‘‘ or (payload) and ‘=’‘(payload)’‘ or (payload) and ‘ 下面是一个保存注册用户信息为XML格式的例子： final String GUESTROLE = \"guest_role\"; ... //userdata是准备保存的xml数据，接收了name和email两个用户提交来的数据。 String userdata = \"&lt;USER role=\"+ GUESTROLE+ \"&gt;&lt;name&gt;\"+ request.getParameter(\"name\")+ \"&lt;/name&gt;&lt;email&gt;\"+ request.getParameter(\"email\")+ \"&lt;/email&gt;&lt;/USER&gt;\"; //保存xml userDao.save(userdata); 当上面这段代码没有任何过滤时，一个普通用户注册会是这样的↓ &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;USER role=\"guest_role\"&gt; &lt;name&gt;user1 &lt;/name&gt; &lt;email&gt;user1@a.com &lt;/email&gt; &lt;/USER&gt; 但攻击者注册时如果这样注册，构造利用代码如下： user1@a.com&lt;/email&gt;&lt;/USER&gt;&lt;USER role=\"admin_role\"&gt;&lt;name&gt;test&lt;/name&gt;&lt;email&gt;user2@a.com 最终用户注册后，数据就变成了↓： &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;USER role=\"guest_role\"&gt; &lt;name&gt;user1 &lt;/name&gt; &lt;email&gt;user1@a.com&lt;/email&gt; &lt;/USER&gt; &lt;USER role=\"admin_role\"&gt; &lt;name&gt;lf&lt;/name&gt; &lt;email&gt;user2@a.com &lt;/email&gt; &lt;/USER&gt; ##很明显，多出了一条role=“admin_role”的管理员test。以达到攻击目的。## 防御：对关键字进行转义， 例： &amp; --&gt; &amp;amp; &lt; --&gt; &amp;lt; &gt; --&gt; &amp;gt; \" --&gt; &amp;quot; ' --&gt; &amp;#39; 具体函数：StringUtil.xmlencode（） 绕过：闭合（包括闭合函数）→重新构造整个代码，包括函数（当然这是我自己认为的，没实施过。。） 利用位置：注册口","tags":[]},{"title":"SQL注入之nmap","date":"2017-04-08T09:34:11.167Z","path":"2017/04/08/SQL注入之nmap/","text":"NMAP的使用： 常用命令：-u （后面接URL，判断注入，有注入则回显服务器信息）–dbs 查看所有数据库–current-db 列出当前所用的数据库–table 获取数据库表 （接 –D使用; 因为要知道是哪个数据库的表）–columns 获取表中的字段 （接 –T，-D使用，因为要知道哪个表那个数据库）–dump 获取字段内容 （接-C,-T,-D使用，和上同理。。）–r 利用文本（接编码转换文本或HTTP协议包） 以下为Mysql数据注入： -u www.xxx.com/qqq.php?id=1 存在注入，则爆出(网页信息)↓ -u www.xxx.com/qqq.php?id=1 –dbs 爆出所有数据库 选择bsgy数据库并爆表 -u www.xxx.com/qqq.php?id=1 –D “bsgy” –table 选择lefttree表，并爆字段-u www.xxx.com/qqq.php?id=1 –D “bsgy” -T “lefttree” –columns 爆字段内容-u www.xxx.com/qqq.php?id=1 –D “bsgy” -T “lefttree” –C “id,name” –dump Accessz注入：–table（直接猜表名）然后思路同理因为Access没有内置的数据库，而且只有一只，所以直接跑表 注：其它命令：1.测试所有用户权限：–privileges （接-U可指定用户） 2.执行shell命令（需要知道物理路径且可写）：–os-cmd=”cmd命令”–os-shell 3.post 提交：–data “post参数” （可能会自动检测） 4.显示详细参数：-v 0~6 （0~6代表信息等级，） 5.cookies注入：–cookie –lever 3 （&gt;=2即可，3的话会检查User-agent和Referer） 6.数据包注入：-r 要注入的文本 （文本的某一处加‘*’则选择在哪注入，不加则默认是头部注入，这方式适合伪静态注入） 7.注入时使用编码：–tamper ‘py文本’ (适用黑名单绕过) 8.。。。。。 注入工具还有：穿山甲（pangolin） / Havij（小萝卜）。。。 编写人不同，注入方法也不通，都试试吧，可能某一个得呢。。","tags":[]},{"title":"SQL手工注入之mysql","date":"2017-04-08T09:17:21.383Z","path":"2017/04/08/SQL手工注入之mysql/","text":"mysql数据库 版本5.0↑，具有内置特定数据库（information_schema）。 最高权限为root 注入过程： 判断字段数 （order by） 匹配字段数：union select 1,2,3,4,5……. 利用内置函数暴数据库信息system_user() 系统用户名user() 用户名current_user() 当前用户名session_user() 链接数据库的用户名database() 数据库库名version() mysql数据库版本信息load_file() 转换成16或10进制 读取本地文件@@datadir 读取数据库路径@@basedir MYSQL安装路径@@version_compile_os 操作系统 查表：Union selec 1,group_concat(table_name) ,3 frominformation_schema.tables where table_schema= 数据库名的hex编码 表里面的列union select 1,group_concat(column_name),3 frominformation_schema.columns wheretable_name=表的HEX值 Union select 1,group_concat(列名),3 from 表名","tags":[]},{"title":"SQL手工注入之Oracle","date":"2017-04-08T09:14:16.455Z","path":"2017/04/08/SQL手工注入之Oracle/","text":"文章：http://www.2cto.com/article/201301/186345.html 注：字段位置应写为null..不可以用数字，因为Oracle是强类型数据库。必须表明类型，null就可避免类型限制。","tags":[]},{"title":"SQL手工注入之Access","date":"2017-04-08T09:11:27.016Z","path":"2017/04/08/SQL手工注入之Access/","text":"Access（数据库后缀名为：.mdb） 数据库结构： 判断是否存在注入（报错，“*”and/or;在网址最后输入（’；）,返回不正常的时候,说明是access类型的。反之，则是mssql类型） 判断数据库表名：and exists(select * from [表名]) 判断数据库列名：and exists(select [列名] from [表名]) 判断字节长度：order by 数字 联合查询注入：union select 1,2,… from [表名] 根据数字位置爆数据。 偏移注入（知道表名却不知道列名的情况下使用）：假设表名为admin。初始字段数为12 判断字段数（order by ） 爆显示位 用“”代替字符，计算代替字符的位数 当访问：http://127.0.0.1/0/Pro/P.asp?id=1513 UNION SELECT1,2,3,4,5,6,7, from admin 页面返回正确（说明admin表有7个字段）if：已经减去了五个字段则 = 5个字符2 x * = 10个字符12-10=2个字符 http://127.0.0.1/0/Production/PRODUCT_DETAIL.asp?id=1513 UNION SELECT 1,2,a.id,b.id, * from (admin as a inner join admin as b on a.id=b.id) 如果不显示可以查看元素看看是不是隐藏了 真没有就二级偏移注入。。 再减7个字段 POC写成：UNION SELECT 1,2,a.id,b.id,c.id * from ((admin as a inner join admin as b on a.id=b.id) inner join admin as c on a.id=b.id) 三级。。。 四级。。。。。。。 跨库注入（知道数据库的绝对路径，然后猜表名）： and exists(select * from 数据库绝对路径.表名)","tags":[]},{"title":"SQL手工注入之SQL Server（mssql）","date":"2017-04-08T09:05:13.871Z","path":"2017/04/08/SQL手工注入之mssql/","text":"SQL Server（mssql）（一般搭配asp/asp.net(aspx)+mssql） 数据库结构： 权限：1.最高：sa（任何操作：文件管理/数据库操作/命令执行等）2.普通：db（文件管理，数据库操作等）3.最菜：public（数据库操作） 注入（手工判断）： And 1=1和and 1=2 组合判断 （用永真和永假判断） and (select count(*) from sysobjects)&gt;0 返回正常就是mssql数据库 版本信息查看：and 1=(select @@version)获取当前网站所用数据库库名：and 1=(select db_name())获取第一个数据库库名：and 1=(select top 1 name from master..sysdatabases where dbid&gt;4)获取第二个数据库库名：and 1=(select top 1 name from master..sysdatabases where dbid&gt;4 and name &lt;&gt; ‘第一个数据库库名’)获取第三个数据库库名：and 1=(select top 1 name from master..sysdatabases where dbid&gt;4 and name &lt;&gt; ‘第一个数据库库名’ and name &lt;&gt; ‘第二个数据库库名’)其它同理。。。。 获取第一个当前使用的数据库表名：and 1=(select top 1 name from sysobjects where xtype=’u’)and 1=(select top 1 name from sysobjects where xtype=’u’ and name &lt;&gt;’第一个表名’)其它同理。。。 获取第一个当前使用的数据库的表里面的列名：and 1=(select top 1 name from syscolumns where id=(select id from sysobjects where name = ‘表名’))获取第二个列明and 1=(select top 1 name from syscolumns where id=(select id from sysobjects where name = ‘表名’)and name&lt;&gt; ‘第一个列名’)其它同理。。 获取列内容（假如表是users列是name）and 1=(select top 1 name from users)其它同理。。。。","tags":[]},{"title":"SQL注入之类型简介","date":"2017-04-08T08:59:30.913Z","path":"2017/04/08/SQL注入之类型简介/","text":"SQL注入原理：SQL注入攻击指的是通过构建特殊的输入作为参数传入Web应用程序，而这些输入大都是SQL语法里的一些组合，通过执行SQL语句进而执行攻击者所要的操作，其主要原因是程序没有细致地过滤用户输入的数据，致使非法数据侵入系统。（数据库语句没有进行严密的过滤，致使执行非法查询） SQL分类：1.数字型注入 2.字符型注入 3.搜索型注入 数字型:参数为数字。 例：www.test.com/test.php?id=123字符型：参数为字符（英文字符串） 例：www.test.com/test.php?id=asd搜索型：注入位置为搜索框例： 区别：SQL查询语句不相同。数字型：$sql=”select from A where id=$id”;字符型：$sql=”select from B where id=’$user ‘“;搜索型：$sql=”select * from user where username like ‘%$name%’ order by username”; 注入方式：GET，（请求头，URL位置）Post，（表单提交的注入，例：登陆框）Cookies,（利用Cookie 注入中转/手工编辑新的Cookies也可，即把参数写道Cookie里面（firebug里有编辑Cookie的插件）） 数据库分类：1). SQL Server （别名：mssql）2). Access3). Oracle4). MySql5). Sysbase6). Informix7). FoxPro8). PostgreSQL9). IBM 的DB2 前面四种是常见的，包含了大多数的中小企业，所以暂时先讲这四种，等哪天我成为大神再补充。后面的五种。。。就这样。 注：1.数据库不同，查询语句的连接符也不同 Mssql：“+” Oracle：“||” Mysql:：空格 Access：“&amp;” 灵活运用：or/and/xor/+ 后台，审查元素，name属性有意想不到的结果（写着字段） 下载CMS分析 基于布尔的SQL盲注—-构造逻辑判断基于时间的盲注—延时注入基于报错的盲注","tags":[]},{"title":"信息收集之CMS","date":"2017-04-08T08:40:20.964Z","path":"2017/04/08/信息收集之CMS/","text":"主要CMS：discuz ,dedecms（织梦）,wordpress,phpcms,jeecms,joomla,动易， 查看robots.txt 网页图标 主页最下面的一栏信息 通过站长工具的Whois或者zoomeye.org… 后台模板 工具（椰树，m7lrv） 作用：方便上网查询相关CMS漏洞、后台位置、默认密码等","tags":[]},{"title":"信息收集之真实IP查询","date":"2017-04-08T08:40:20.963Z","path":"2017/04/08/信息探测之真实IP查询/","text":"ping (ping带WWW、和ping不带www) （不一样则存在CDN） 采集二级域名（子域名）（URL采集工具）URL采集(子域名挖掘)→域名批量查询（http://ip.chinaz.com/ipbatch）→找非节点（CDN）IP→ 查看接受收的邮件，显示原文，看IP 基本上所有的大站都有一个段（C段），这个段可能会有几个系统，且ip很接近 通过威胁情报平台360: https://ti.360.com/#ThreatBook: https://x.threatbook.cn 查域名历史IP(在历史解析里面一般存在真实IP段)http://viewdns.info/iphistory/?domain=https://www.zoomeye.orgwww.shodan.io 全网扫描http://www.evil0x.com/posts/6547.html 查防护软件等信息（出现防护警告时）查看元素→网络→消息头→X-Safe-Firewall搜索 防护提示符 找真实IP的作用：运用DDOS攻击（分布式拒绝服务攻击）/直接尝试连接服务器配合DDOS作用：造成防火墙处理错误锁死、服务器瘫痪CDN作用：实时的根据网络流量和个节点的接连、负载情况以及用户的距离和相信时间将用户的请求重新导向离用户最近的服务器节点上。内容服务基于缓存服务器，也称为代理缓存。","tags":[]},{"title":"信息探测之nmap的使用（端口）","date":"2017-04-08T08:40:20.962Z","path":"2017/04/08/信息探测_端口篇/","text":"Nmap:可用于端口扫描/指纹识别/检测SQL注射/网页爬行/数据库密码检查等 Nmap参数的使用： -sT TCP连接扫描 （被扫描的系统会产生大量连接信息并写入日记） -sS 半开扫描 (即TCP SYN扫描) 很少系统把他写入系统日记 -sN/sF Fin数据包扫描 （即使SYN扫描都无法确定的情况下使用） -sP ping扫描 （测试一个段的主机存活IP） -sU UDP扫描 （因为不可靠，所以一般不用） -sA 穿过防火墙的规律集 -sV 探测端口服务版本 -P0 当被禁止Ping时可用此选项扫描 -v 显示扫描过程 -p 指定端口扫描（只扫描3389和80 -p “3389、80”） 利用方法：扫描www.baidu.com 的C段存活主机 Nmap –sP www.baidu.com/24 注：假如扫描为IP （222.332.186.121）， 应为 222.332.186.0/24 指定端口扫描： Nmap www.baidu.com(或填服务器IP) –p 80，3389，1433，（或1~X） 检查主机系统： Nmap –o www.baidu.com(或填服务器IP) 端口： 8080（Apache/Tomcat/Nginx/Axis2）, 21（控制端口）； 20（数据端口）；69（tftp小型文件传输协议）[FTP] 3306(MySQL数据库) 1433（Server 数据库服务）、1434（Monitor 数据库监控） (MSSQL数据库) 1521（数据库端口）、210（Oracle XDB FTP服务） (Oracle数据库) 25（smtp）、465（smtps）(SMTP协议) 53(DNS服务) 67&amp;68、546（DHCP服务） 22(SSH服务) 80/81/443(IIS服务) 7001(WebLogic) 1098/1099/4444/4445/8080/8009/8083/8093(Jboss) 908*；第一个应用就是9080，第二个就是9081；控制台9090(Websphere)","tags":[]},{"title":"信息探测之谷歌黑客语法的使用","date":"2017-04-08T08:40:20.960Z","path":"2017/04/08/信息探测_谷歌语法/","text":"Google Hack:（大部分语法也可用于百度） 主要语法：Site：找到与指定网站有联系的URL。 （用于搜索子域名）Intext：正文存在关键字的网页 （搜索重要信息）Intitle：标题中存在关键字的网页 （搜索后台等具有关键字的URL）Inurl：url中存在关键字的网页 （寻找伪静态持有的网页类型）Filetype:指定文件类型Site和inurl区别：Site:把搜索范围限定在特定站点中Inurl:吧搜索范围限定在url链接中 多种组合能达到意想不到的效果：例如：查看后台：inurl:baidu.com intext:后台管理查看上传点:site:xx.com inurl:filesite:xx.com inurl:loadinurl:baidu.com Intitle:上传查看ASP语言的后台Intitle:后台管理 filetype:asp星云CMS系统inurl:Showservices.asp?id= inurl:showkbxx.asp?id=利用：1.假如攻击者拥有的一个0day漏洞，则可以用此语法配合0day指纹进行批量的入侵。2.寻找网页后台（admin/login）、敏感文件（robots.txt/db.mdb）、敏感路径（upload）","tags":[]},{"title":"漏洞扫描之工具使用篇","date":"2017-04-08T08:24:16.651Z","path":"2017/04/08/漏洞扫描之工具篇/","text":"常用工具：AWVS/Appscna/Netsparker工具的使用 AWVS功能：Tools（工具）Web scanner 网站漏洞扫描 Site Crawler 网站爬行 Target Finder 扫描自定网段，开放指定端口的服务器 Subdomain Scanner 子域名扫描 Blind SQL injection Sql盲注手工测试 HTTP Editor HTTP信息查看编辑 HTTP Sniffer HTTP监听嗅探 HTTP fuzzer HTTP模糊测试 Authentication Tester HTTP认证测试 Compare Results 对比两次Acunetix扫描结果 Web Servces（Web服务） Web Services Scanner 网站服务扫描 。。。。。。。。。。 网站服务手动分析 Configuration（配置） Application Settings 应用程序设置 Scan Settings 扫描设置 Scanning Profiles 配置所用扫描脚本 General（一般） 。。。。。。。。。。。。。。。。。（AWVS的相关信息，破解版略过） 步骤：点击New Scan后可傻瓜式点击Next… 注：当点击第二布Options时可选择扫描类型 （没有针对性的话一般使用Default） 注：当点击Target时可查看网页服务器的类型 扫描结果： Site Crawler 的利用：输入URL，啪啪啪啪啪啪啪，就出来一堆“能看到的URL”了。 爬行小工具还有：burp suit/….网段端口扫描工具：nmap（windows版应该是Znmap）子域名查询：一般网页就有（搜索子域名查询）SQL盲注等注入：SQLMAP（带有过狗过防火墙的脚本，贼强）有关数据包的（HTTP协议包）：直接burp suit工具软件抓包：Wireshark工具 Netsparker：方法一样，Start New Scan ，输入URL，自动扫描漏洞。","tags":[]},{"title":"HTTP协议","date":"2017-04-08T04:38:10.917Z","path":"2017/04/08/HTTP协议/","text":"HTTP协议（超文本传输协议）： URL：网页地址。例：http://www.xxx.com/abc/bcd.html http://www.xxx.com/index.asp http://www.xxx.com 等都是URL。 HTTP遵循：请求（request）、相应（respsonse） 两部分 http请求（request）： 当发送请求包，自然也有响应包：http响应： HTTP请求方式：Get、Post、Put、Delete、trace、等常见如下：Get：用于短内容和不用保密的信息Post：用于传输长内容或需保密的信息。 危险请求方式：PUT：危险请求方式，用于请求服务器把请求的实体储存在请求资源下。如果资源存在，则替换服务器的原先数据。（用抓包工具利用）Delete：请求方式可改成删除指定资源Trace：允许客户端了解数据链另一端的接受情况，并利用这些数据信息去做相关测试。…. 响应行重要状态码：200：请求成功，正常执行 302：网页发生跳转 （URL重定向） 401：未授权 403：服务器拒绝服务。 404：请求资源不存在 500：服务器内部错误。 http与https区别：https单纯的比http更安全而已。安全基础是SSL。即：http+SSL == https Http端口：80https端口：443 截取http协议包工具：burpsuit/Fiddler/ 利用截取的协议包，可进行任意的更改操作。从而达到相关测试的目的。例如：1．修改/伪造的Cookies值 从而达到登陆的目的 2．无限重放协议包，从而达到自动化暴力破解登陆账号的目的 3．修改请求的上传文件类型。从而绕过本地/远程白名单限制。 4．查看上传地址，从而获取上次文件的URL位置 5．简单获取服务器信息","tags":[{"name":"Web安全","slug":"Web安全","permalink":"http://yoursite.com/tags/Web安全/"}]}]